<div class="wrapper-form">
    <label class="search">
        <input type="search" name="" class="form-control search" placeholder="Search...">
    </label>

    <section class="wrapper-dropdownFilter" data-wrapper="dropdownFilter">
        <div class="dropdown dropdownFilter">
            <button class="btn dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">Zone</button>
            <div class="dropdown-menu">
                <div class="container-search">
                    <input type="text" class="dropdown-search form-control" placeholder="Search...">
                </div>

                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="todos" class="parent-all" data-group="._Zone">
                    <span>All</span>
                </label>

                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="africa" value="AFRICA" data-item="checkbox" class="_Zone">
                    <span>AFRICA</span>
                </label>
                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="apac" value="APAC" data-item="checkbox" class="_Zone">
                    <span>APAC</span>
                </label>
                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="eur" value="EUR" data-item="checkbox" class="_Zone" checked>
                    <span>EUR</span>
                </label>
                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="ma" value="MA" data-item="checkbox" class="_Zone" checked>
                    <span>MA</span>
                </label>
                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="na" value="NA" data-item="checkbox" class="_Zone" checked>
                    <span>NA</span>
                </label>
                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="sa" value="SA" data-item="checkbox" class="_Zone" checked>
                    <span>SA</span>
                </label>
            </div>
        </div>

        <div class="dropdown dropdownFilter">
            <button class="btn dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">Group</button>
            <div class="dropdown-menu">
                <div class="container-search">
                    <input type="text" class="dropdown-search form-control" placeholder="Search...">
                </div>

                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="todos" class="parent-all" data-group="._Group">
                    <span>All</span>
                </label>

                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="africa" value="BOP" data-item="checkbox" class="_Group">
                    <span>BOP</span>
                </label>
                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="apac" value="VOP" data-item="checkbox" class="_Group">
                    <span>VOP</span>
                </label>
                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="eur" value="SOP" data-item="checkbox" class="_Group">
                    <span>SOP</span>
                </label>
                <label class="dropdown-item" data-item="dropdownFilter">
                    <input type="checkbox" name="eur" value="ZoneHQ" data-item="checkbox" class="_Group">
                    <span>Zone HQ function</span>
                </label>
            </div>
        </div>
    </section>
</div>

<style>
    .wrapper-form{
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .wrapper-form label.search{
        flex: 1;
        max-width: 350px;
        margin-bottom: 0;
    }
    .wrapper-form .form-control.search{
        border: 0;
        border-radius: 1.5rem;
        height: 50px;
        background-color: #eeeeee;
    }
    .wrapper-form .form-control.search:focus{
        box-shadow: 0 0 0 .1rem rgba(255, 151, 0, 0.5);
    }

    .wrapper-dropdownFilter{
        display: flex;
        gap: 1rem;
    }

    .dropdownFilter .dropdown-toggle{
        display: flex;
        align-items: center;
        justify-content: center;
        height: 50px;
        padding: 0.375rem 1.5rem;
        border-radius: 1.5rem;
        border: 1px solid #eee;
        background-color: #eee;
        transition: all 0.3s;
    }
    .dropdownFilter .dropdown-toggle:hover{
        background-color: #e8e8e8;
    }
    .dropdownFilter .dropdown-toggle::after {
        display: inline-block;
        margin-left: .755em;
        padding-top: 0.25em;
        vertical-align: 0.0em;
        border: 0;
        content: "\F282";
        font-size: 0.85rem;
        font-family: bootstrap-icons !important;
    }
    .dropdownFilter .dropdown-toggle.active{
        color: #ad8517;
        border-color: rgb(255, 151, 0, 0.7);
        background-color: rgb(255, 151, 0, 0.2);
    }
    .dropdownFilter .dropdown-toggle.active:hover{
        border-color: rgb(255, 151, 0, 0.1);
        background-color: rgb(255, 151, 0, 0.3);
    }
    .dropdownFilter .dropdown-toggle:focus{
        box-shadow: none;
    }

    .dropdownFilter .dropdown-menu{
        padding: 0;
        border: 0;
        min-width: 200px;
        max-height: calc(100vh - 192px);
        overflow: auto;
        box-shadow: 0px 2px 4px 0px rgba(0,0,0, 0.2), 0px 4px 8px 0px rgba(0,0,0, 0.2);
    }

    .dropdownFilter .dropdown-menu .container-search{
        padding: 0.5rem;
    }
    .dropdownFilter .dropdown-menu .dropdown-search{
        
    }

    .dropdownFilter .dropdown-menu .dropdown-item{
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0;
        padding: 0.75rem 1.5rem;
        transition: all 0.3s;
        
    }

    .dropdownFilter .dropdown-menu .dropdown-item input[type="checkbox"]{
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        width: 18px;
        height: 18px;
        border-radius: 4px;
        border: 1px solid #ccc;
        background-color: #fff;
        transition: all 0.2s;
        overflow: hidden;
    }

    .dropdownFilter .dropdown-menu .dropdown-item input[type="checkbox"]:checked{
        background-color: #ff9700;
    }
    .dropdownFilter .dropdown-menu .dropdown-item input[type="checkbox"]:checked::after{
        content: "\F26E";
        color: #fff;
        font-size: 1.4rem;
        font-family: bootstrap-icons !important;
    }
</style>

<script is:inline>
    function initDropdownFilters(wrapperSelector) {
        $(wrapperSelector).find('.dropdown.dropdownFilter').each(function () {
            let dropdown = $(this);
            let container = dropdown.find('.dropdown-menu');
            let button = dropdown.find('button');

            // Função para atualizar os valores e estado do botão
            function updateCheckedValues() {
                let checkedValues = container.find('[data-item="checkbox"]:checked').map(function () {
                    return $(this).val();
                }).get();

                console.log(`Dropdown "${button.text()}":`, checkedValues);

                // Adiciona ou remove a classe 'active' no botão
                if (checkedValues.length > 0) {
                    button.addClass('active');
                } else {
                    button.removeClass('active');
                }
            }

            // Impede que o dropdown feche ao clicar nos labels ou inputs
            container.find('[data-item="dropdownFilter"]').on("click", function(e) {
                if (e.target.tagName.toLowerCase() === "input") return;
                e.stopPropagation();
            });

            // Busca em tempo real, só se existir
            container.find('.dropdown-search').on('input', function () {
                let search = $(this).val().toLowerCase();
                container.find('[data-item="dropdownFilter"]').each(function () {
                    let text = $(this).text().toLowerCase();
                    $(this).toggle(text.includes(search));
                });
            });

            // Checkboxes individuais (excluindo "Todos")
            container.find('[data-item="checkbox"]').not('.parent-all').on("change", function () {
                updateCheckedValues();
            });

            // Checkbox "Todos"
            container.find('.parent-all').each(function () {
                let parent = $(this);
                let group = parent.data('group');

                // Ao clicar em "Todos"
                parent.change(function () {
                    container.find(group).prop('checked', parent.prop('checked'));
                    updateCheckedValues();
                });

                // Quando qualquer filho muda, atualiza o "Todos" sem log duplicado
                container.find(group).change(function () {
                    parent.prop(
                        'checked',
                        container.find(group + ":checked").length === container.find(group).length
                    );
                    updateCheckedValues(); // atualiza botão mesmo se checkboxes já marcados
                });
            });

            // Inicializa o estado do botão ao carregar, refletindo checkboxes já marcados
            updateCheckedValues();
        });
    }

    $(document).ready(function() {
        initDropdownFilters('[data-wrapper="dropdownFilter"]');
    });
</script>